# README â€” Automated RPD Comparison Testing Procedure

This document describes the testing workflow used to validate RPD files generated by the EnergyPlus RPD utility
against the expected RPD files included in the 229P test suite. Test models were provided by FSEC and PSD.

## Overview

This testing procedure performs automated comparisons between:

1. The **generated RPD files** produced by the EnergyPlus RPD utility.
2. The **expected RPD files** included with the 229P test suite.

All files must validate against version **0.1.7** of the 229 schema.  
If any file fails schema validation, the script terminates immediately.

## Object Mapping Logic

RPD files contain many arrays in which element order is not meaningful.  
Because of this, objects in the generated RPD must first be mapped to their corresponding objects in the expected RPD.

The script applies object-type-specific mapping logic. Examples include:

- **Surfaces** are mapped using:
  - `classification`
  - `adjacent_to`
  - the zone the surface belongs to  
  This mapping accounts for the fact that interior surfaces may appear in either the same zone as the reference surface
    or in the adjacent zone, with azimuth adjusted by 180 degrees.

If the map is incorrect or incomplete, comparison results may be misleading.

Incorrect mapping may indicate:
- A problem in how the translator generated objects.
- A missing or incomplete mapping rule for a specific scenario.

## Inspecting the Object Map

There is no dedicated visualization tool for reviewing the object map.  
To inspect it:

1. Run the test script in **debug mode**.
2. Set a breakpoint immediately after object mapping is completed by `map_objects()` in `perform_comparison.py` 
3. Inspect the `object_id_map` in-memory mapping structure

## Regenerating the Test RPD Files

All test RPD files can be regenerated using:
- `generate_229_test_rpds.py`


You should regenerate test files **whenever updates are made to**:
- `translator.py`
- support a new version of EnergyPlus

Regenerating ensures the generated files reflect the current translator logic before comparing them with the Standard-provided expected RPDs.

## Summary of Workflow

1. Run the script to generate RPDs.
2. Validate all generated RPDs against 229 schema version 0.1.7.
3. Allow the script to perform object-to-object mapping.
4. Inspect mapping (if needed) via breakpoints in perform_comparison.py around the object_id_map returned by map_objects().
5. Compare generated RPD files to Correct Answer RPD files via automated comparison logic.


